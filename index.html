<!DOCTYPE html>
<html>
<head>
    <title>React avec TypeScript et ES6</title>
    <meta charset="utf-8">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
        @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
        @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

        body {
            font-family: 'Droid Serif';
        }

        img {
            max-width: 100%;
        }

        h1, h2, h3 {
            font-family: 'Yanone Kaffeesatz';
            font-weight: 400;
            margin-bottom: 0;
            margin-top: 10px;
        }

        h1 {
            font-size: 3.5em;
        }

        h2 {
            font-size: 3em;
        }

        h3 {
            font-size: 1.6em;
        }

        p {
            margin: .5em 0;
        }
        .inverse {
            background: #272822;
            color: #777872;
            text-shadow: 0 0 20px #333;
        }

        .inverse h1, .inverse h2 {
            color: #f3f3f3;
            line-height: 0.8em;
        }

        pre {
            border-left: 0.4em solid #d7d7d7;
            padding-left: 0.5em !important;
            margin-top: .5em;
            margin-bottom: 0;
        }

        code {
            background: transparent !important;
            padding-left: 0.2em !important;
        }

        a {
            color: #F92672;
            text-decoration: none;
        }

        .task {
            float: right;
            font-size: 0.9em;
            padding-top: 0.6em;
        }

        .task a {
            color: #080;
            text-decoration: none;
        }

        .right {
            float: right;
            margin-left: 1em;
        }

        .pushdown {
            margin-top: 12em;
        }

        .remark-code, .remark-inline-code {
            font-family: 'Ubuntu Mono';
        }

        li {
            margin-bottom: .8em;
        }
    </style>
</head>
<body>
<textarea id="source">

class: center, middle, inverse

# React
### avec TypeScript et ES6

#### [@jbcazaux](http://twitter.com/jbcazaux)

---

# Contenu

* ES6
    * Nouveautés
    * Rappels sur la programmation fonctionnelle
* TypeScript
    * Langage et mots-clés
* ReactJS
    * Principes
    * Composants
---

class: center, middle, inverse

# EcmaScript 6

---
template: default
layout: true

### EcmaScript 6

---

# Nouveautés

* Pas totalement supporté par les navigateurs : [Tableau de compatibilité](http://www.webbrowsercompatibility.com/es6/desktop/)
    * Transpiler
    * Shim
* ~~var~~, let, const
```typescript
    let foo = 'bar';
    const MAX = 10;
```
* Arrow functions
```typescript
    let add = (a, b) => {
        return a + b;
    }
    let add = (a, b) => a + b
```
---

# Nouveautés

* Spread operator
```typescript
    let tab = [1, 2, 3];
    let arr = arr.push(...tab);
```
* Destructuring
```typescript
    //TODO
```
* Shorthand Notation
```typescript
    let longer = {
        foo: foo,
        bar: bar
    }
    let shorter = {
        foo,
        bar
    }
```
---

# Rappels

* currying
```typescript
    let add = function(x) {
        return function(y) {
            return x+y
        }
    }
    let add2 = add(2); add2(3); // = ?
    add(2)(3) // ???
    let add = x => y => x + y // WTF ?!
```
* this
```typescript
    function f() {
        this.foo; // what is this ?
    }
```
---

class: center, middle, inverse
layout: false
# TypeScript

---
template: default
layout: true

### TypeScript

---


* Types de base: [https://www.typescriptlang.org/docs/handbook/basic-types.html](https://www.typescriptlang.org/docs/handbook/basic-types.html)
* Interface
```typescript
    interface Props = {
        lat: number;
        lng: number;
    }
```
* Classe
```typescript
    class User {
        constructor(public id: number, public login: string) {}
    }
    let user1 = new User(1, 'toto');
```
---

* Type
```typescript
    interface Props extends DispatchProps, StateProps {}
    type Props = DispatchProps & StateProps;
```
* Génériques
```typescript
    function toArray<T>(arg1: T, arg2: T): T[] {
        return [arg1, arg2];
    }
    toArray(5, 6);
    toArray(5, 'hello'); // Bim !
```
---

* Typings
```
$> typings search react
    NAME                              SOURCE HOMEPAGE                                                      DESCRIPTION VERSIONS UPDATED
react                             dt     http://facebook.github.io/react/                                          2        2016-08-17T20:12:27.000Z
react-bootstrap                   dt     https://github.com/react-bootstrap/react-bootstrap                        1        2016-08-06T07:24:14.000Z
$> typings install --save --global dt~react
```


---
layout: false
class: center, middle, inverse

# React
---

template: default
layout: true

### Intro
---

#Hello world
```typescript
import * as React from 'react';
import * as ReactDOM from 'react-dom';

import { Hello } from './hello';

ReactDOM.render(
    <Hello name="world"/>,
    document.getElementById("app")
);
```
```typescript
import * as React from 'react';

interface Props { name: string;}

export class Hello extends React.Component<Props, void> {
    render() {
        return <h1>Hello {this.props.name}!</h1>;
    }
}
```
---

#JSX
```typescript
render: function() {
    return (
      <li className="contact">
          <h2 className="contact-name">{this.props.name}</h2>
      </li>
    )
}
```
```typescript
render: function() {
    return (
      React.createElement('li', {className: 'contact'},
        React.createElement('h2', {className: 'contact-name'},
                                            this.props.name)
      )
    )
}
```
---

#Create or extends ?
```typescript
export const Hello = React.createClass<Props, void>({
    render: function() {
        return (
            <h1>Hello {this.props.name}!</h1>
        );
    }
});
```
```typescript
export class Hello extends React.Component<Props, void>{
    render() {
        return (
            <h1>Hello {this.props.name}!</h1>
        );
    }
}
```

---
layout: false

#TP-01
## Hello World !

1. Etendre la classe React.Component
2. Implémenter la méthode render()

---

template: default
layout: true

### React.Component

---

#Composant et Cycle de vie
* seule **render()** est obligatoire
* **getInitialState()**: invoqué une seule fois à la création du composant
* **getDefaultProps()**: invoqué une seule fois aussi
* **propTypes**, **mixins**, **statics**: plus tard... ;)
* **componentWillMount()**: J'arrive !
* **componentDidMount()**: Je suis là !
* **componentWillReceiveProps(**nextProps: Object**)**
* **shouldComponentUpdate(**nextProps: Object, nextState: Object**)**: Qu'est ce qu'on fait, chef ?
* **componentWillUpdate(**nextProps: Object, nextState: object**)**: A l'attaque !
* **componentDidUpdate(**nextProps: Object, nextState: object**)**: job done
* **componentWillUnmount()**: bye bye !

---
# State

* getInitialState() / this.state = {...}
* this.setState({...})
* this.state

---
# Props vs State
* Props
    * Les données passées par les parents
* State
    * Bien
        * Les données modifiables par les événements de la UI
        * Le plus possible de composants sans état
    * Pas bien
        * Des données calculées (à faire dans render)
        * Des données dérivées des *props*
        * Des composants

---
#Stateless component
```typescript
import * as React from "react";

interface Props { name: string;}

export const Hello = ({name}: Props) => <h1>Hello {name}!</h1>;
```

---
layout: false

#TP-02
## Liste de courses
1. Chercher et installer typings axios
2. Faire compiler le code (interfaces Props et State)
3. Mettre un état par défaut
4. Afficher un message de log pour chaque moment du cycle de vie
5. Créer un composant distinct pour les éléments (li) de la liste
6. Bonus: Utiliser une classe qui encapsule le composant et gère l'état
---
#Bonus TP-02
```typescript
export class ShoppingList extends React.Component<Props, State> {
    // constructor...
    // componentDidMount() {...}
    render() {
        return (
            <ShoppingListInternal
                    title={this.props.title}
                    items={this.state.items}/>
        )
    }
}

type PropsInt = Props & State;
const ShoppingListInternal = ({title, items}: PropsInt) => (
    <div>
        <h2>{title}</h2>
        <ul>
            {
                items.map(item => <ShoppingItem key={item.id} item={item}/>)
            }
        </ul>
    </div>
)
```
---

template: default
layout: true

### Callbacks

---
# Passer des fonctions dans Props
```typescript
export class ShoppingList extends React.Component<Props, State> {
    // constructor...
    // componentDidMount() {...}
    deleteItem() {
        let newItems = this.state.items.slice(1);
        this.setState({items: newItems});
    }
    render() {
        return (<ShoppingListInternal
                    title={this.props.title}
                    items={this.state.items}
                    del={this.deleteItem.bind(this)}/>)
    }
}

interface PropsInt {title: string;items: Item[];del: () => void}
const ShoppingListInternal = ({title, items, del}: PropsInt) => (
    <div>
        <h2>{title}</h2>
        <ul>
            {items.map(item => {
                return (<li onClick={del}>
                        <span>{item.label}</span>:<span>{item.price}€</span>
                        </li>
                )})}
        </ul>
    </div>
);
```
---

template: default
layout: true

### Avec du style

---
#inline style vs css

Pourquoi pas du inline ?

```typescript
render() {
	const mystyle = {
		'backgroundColor': '#F0ABCD'
	}
	return <div style={mystyle}>
}
```
Sinon une CSS globale, ou une CSS par composant (Webpack powered)

```typescript
let css = require('./mycomponent.css');
```
---

#React-bootstrap
Adaptation des composants bootstrap à React
```typescript
<Button bsStyle="primary" onClick={this.handleClick.bind(this)}>Go!</Button>
```

La documentation
* [https://react-bootstrap.github.io/components.html](https://react-bootstrap.github.io/components.html)
* [http://getbootstrap.com/components/](http://getbootstrap.com/components/)

---

template: default
layout: true

### Tips

---

# JSX if (else)
if
```typescript
{this.state.user && <div>{this.state.user.login}</div>}
```
not
```typescript
{this.state.user || <div>No User</div>}}
```
if-else
```typescript
{this.state.user ? <div>{this.state.user.login}</div> : <div>No User</div>}
```
---

# Children

```typescript
interface Props {
    title: string;
}

export class ButtonApp extends React.Component<Props, void> {
    render() {
        return <Button {...this.props}>hello world</Button>
    }
}
```
```typescript
interface ButtonProps {
    title: string;
    children?: any;
}

export const Button = ({title, children}: ButtonProps) => (
    <button title={title}>
        {children}
    </button>
);
```
---
layout: false

#TP-03
## Liste des étudiants
1. Installer react-bootstrap
2. Afficher un champ texte qui permet de filtrer les éléments d'un tableau
3. Afficher le nom de l'étudiant sur lequel on a cliqué, ou un message si aucun n'est sélectionné
4. Bonus ES6: Calculer de façon élégante la moyenne des notes d'un élève
---

# Rappels
* Un composant a des propriétés et des états
* Un composant stateless est plus maintenable et testable
* On ne peut passer des propriétés qu'aux enfants (ce n est pas de l'héritage;) )

---
layout: false
class: center, middle, inverse

# Flux & Redux
---

template: default
layout: true

### Flux & Redux

---

# Flux

* Store: Stocker la donnée + Logique
* Action: Modifier le modèle
* Dispatcher: Répartir les actions dans les stores
* View: Les composants UI

![flux acton diagram](images/flux.png)

**Le flux ne va que dans un seul sens !** (~~2-way binding~~)


---

# Bien / Pas bien

![best practices](images/flux-bestpractice.png)

* On ne met pas à jour directement les autres composants
* On passe par le store (redux), les stores (flux), les observables (angular2), ...

---

# Redux

* Un store unique (pratique pour l'isomorphisme)
* L'état du store est read-only
* On émet des *actions* pour modifier l'état
* Les actions sont interprétées par des *reducers*
    * les *reducers* sont des fonctions *pures*
    * les *reducers* prennent en entrée l'état précédent et une action
    * ils retournent le nouvel état dans un objet immutable

![redux](images/redux.png)

---

# Actions

### Action
```typescript
export interface FilterAction {type: string; display: boolean;
}
```
### Action Creator
```typescript
export const filterWarnings = (display: boolean): FilterAction => {
    return {type: 'FILTER_WARNINGS', display};
};
```

![redux](images/redux.png)
---

# Reducer
```typescript
export const display =
(state: DisplayFilter = new DisplayFilter(), action: FilterAction) => {
    switch (action.type) {
        case 'FILTER_WARNINGS':
           return new DisplayFilter(action.display, state.date, state.user);
        case 'FILTER_DATE':
           return new DisplayFilter(state.warnings, state.date, action.display);
        case 'FILTER_USER':
           return new DisplayFilter(state.warnings, action.display, state.user);
        default:
           return state;
    }
};
```

Le *state* est en read-only !
```typescript
interface State = {
    warning: boolean;
    user: boolean;
    date: boolean;
};
Object.assign({}, state, {warning: action.display});
```
![redux](images/redux.png)
---

# Store

```typescript
interface Store<S> {
    dispatch: Dispatch<S>;
    getState(): S;
    subscribe(listener: () => void): Unsubscribe;
    replaceReducer(nextReducer: Reducer<S>): void;
}
```
* Le *store* garde l'état de l'application. On y accède via *getState()*.
* ~~setState()~~ !! On modifie l'état en 'dispatchant' une action: *dispatch(filterWarnings(true))*
* On peut être prévenu des changements du store via *subscribe(listener)*
* On se désenregistre avec la méthode retournée par *subscribe*

![redux](images/redux.png)
</textarea>
<script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
</script>
<script>
    var slideshow = remark.create({highlightLanguage: 'typescript'});
</script>
</body>
</html>